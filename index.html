<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--Dansk sprogattribut-->

<html xmlns="http://www.w3.org/1999/xhtml" lang="da">

<head>
    <!--Tegnsæt utf-8-->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!--Mobilskalering-->
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Hyponet</title>
    <link rel="shortcut icon" type="image/png" href="favicon.ico" />
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            border: 0;
        }

        /* denne farve erstatter den blå markeringsfarve */
        ::selection {
            background: #ffff00;
            color: #000;
        }


        p.greenbox {
            background-color: lightgreen;
            line-height: 1.9em;
            font-size: 16px;
            border: 1px #333 solid;
            border-radius: 10px;
            margin-left: 10px;
            margin-top: 0px;
            margin-bottom: 10px;
            padding: 5px;
            width: 450px;
        }

        p.redbox {
            border-radius: 10px;
            background-color: lightcoral;
            line-height: 1.9em;
            font-size: 16px;
            border: 1px #333 solid;
            margin: 10px;
            padding: 5px;
            width: 450px
        }

        div .purpleparagraf {
            background-color: rgb(160, 85, 160);
            line-height: 1.9em;
            font-size: 16px;
            border: 1px #333 solid;
            margin: 10px;
            padding: 5px;
            width: 450px
        }

        svg {
            height: 20px;
            overflow: visible;
        }

        .pil {
            fill: lightgreen;
            stroke: #333;
        }
    </style>

</head>

<body id="body">
    <button id="fjernknap">Tøm vinduet</button>
    <button id="fyldknap">Fyld vinduet fra sidst</button>
    <button id="gemknap">Gem denne samtale</button>
    <button id="NyGrundNodeKnap">Ny kontekst (Ny Grundnode)</button>
 
    <div class="container-fluid" id="samtale">
            <!-- <div id="drag-drop-area"></div> -->

        <p class="redbox" contenteditable="true">Skriv noget her</p>
    </div>

    <!-- Neo4j driver -->
    <script src="/js/neo4j-driver.js"></script>
    <!-- <script src="https://unpkg.com/neo4j-driver"></script> -->
    <!-- JQuery 3.4.1 -->
    <script src="/js/jquery-3.4.1.js"></script>
    <!-- Bootstrap og Popper -->
    <script src="/js/bootstrap.bundle.js"></script>

    <script type="text/javascript">
        $(function () {


            $('body').on('click', '#gemknap', function () {

                GemTilLocalstorage();
            })

            $('body').on('click', '#fjernknap', function () {

                FjernAltIDOM()
            })
            $('body').on('click', '#fyldknap', function () {

                HentAltTilDOM()
            })
            $('body').on('click', '#NyGrundNodeKnap', function (e) {
                //Hvordan får jeg indsat en redbox forrest i samtale
                console.log(e)
                LavEnGrundnodeBoks(e)

            })


            function GemTilLocalstorage() {
                //Hent tidligere indtastninger fra denne browers localstorage
                if (localStorage.getItem("indtastninger") != null) {
                    var indtastninger = localStorage.getItem("indtastninger");
                }
                //Hent JSON
                var indtastninger = JSON.parse(localStorage.getItem("indtastninger"));
                //Skriv til localstorage
                var helehjemmesiden = document.getElementById("samtale").innerHTML;
                localStorage.setItem("indtastninger", helehjemmesiden);
                //Skriv JSON
                localStorage.setItem("indtastninger", JSON.stringify(helehjemmesiden));
                //Erstat HTML med det fra localstorage
            }


            function FjernAltIDOM() {
                //Fjerner indholdet af samtale-div'en og laver et nyt p.redbox
                document.getElementById("samtale").innerHTML =
                    "<p class='redbox' contenteditable='true'>Skriv noget nyt...</p";
            }

            // Retrieve Content
            function HentAltTilDOM() {
                document.getElementById("samtale").innerHTML = JSON.parse(localStorage.getItem(
                    "indtastninger"));
            }


            //Opret forbindelse til neo4j
            //Neo4J forbindelse med javascript-driver
            //HVIS INTET VIRKER SÅ PRØV AT GÅ IND I "MANAGE" FOR DATABASEN OG SE HVILKEN PORT DER ER INDSTILLET
            var driver = neo4j.v1.driver('bolt://localhost:7687', neo4j.v1.auth.basic('neo4j', '123'));
            //Åbn en session
            var session = driver.session()
            //Opret et tekstfelt til grundnoder        
            function LavEnGrundnodeBoks(e) {

                let NytPTag = document.createElement("p");
                $(NytPTag).attr("contenteditable", "true");
                $(NytPTag).addClass("redbox")

                //Hvis der ikke findes nogen redboxes allerede (fordi alt i dommen er slettet)
                if (document.getElementsByClassName("redbox")[0] = undefined) {
                    console.log("der er ingen redboxes i vindues")
                    let NySamtale = document.createElement("div");
                    NySamtale.attr("id", "samtale");
                    NySamtale.attr("class", "container-fluid");
                    document.getElementById("NyGrundNodeKnap").append(NySamtale)
                } else if ($("p.redbox").innerText != "" && e.currentTarget.id != "NyGrundNodeKnap") {
                    $(NytPTag).insertBefore(e.currentTarget);
                    SendGrundNode()
                } else if (e.currentTarget.id == "NyGrundNodeKnap") {
                    $("#samtale").prepend(NytPTag);
                    SendGrundNode()
                }




            }
            //Send indhold til neo4j om at oprette en grundnode
            function LavEnGrundnode(e) {

                session
                    .run(
                        "CREATE (n:ROD {name: \"" + e.target.innerText +
                        "\" }) SET n.creationTime = timestamp() RETURN n.creationTime, n.name, ID(n), labels(n)"
                    )
                    .subscribe({
                        onNext: function (record) {
                            GrundNoden = {
                                GrundNodensCreationTime: record.get('n.creationTime'),
                                GrundNodensID: record.get('ID(n)'),
                                GrundNodensName: record.get('n.name'),
                                GrundNodensLabels: record.get('labels(n)')
                            }
                        },
                        onCompleted: function () {
                            console.log("LavEnGrundnode: " + GrundNoden.GrundNodensLabels[0] +
                                " indhold: " + GrundNoden.GrundNodensName + " ID: " + GrundNoden
                                .GrundNodensID)

                            HentIDTilGrundnode(GrundNoden, e)
                            // session.close()
                        },
                        onError: function (error) {
                            console.log(error)
                        }
                    })

            };

            //Skriv i tekstfeltet og Send ved ENTER
            function SendGrundNode() {

                var kunDenEneGang = true;

                $("p.redbox").keypress(function (e) {
                    //submit ved ENTER
                    if (e.which == 13 && kunDenEneGang && e.currentTarget.id == "") {
                        console.log("ENTER i redbox")
                        //Tillad kun ENTER én gang
                        kunDenEneGang = false;
                        e.preventDefault()
                        LavEnGrundnode(e)
                    } else if (e.which == 13 && kunDenEneGang == false) {
                        kunDenEneGang = true;
                        e.preventDefault()
                        LavEnGrundnodeBoks(e)
                        console.log("ENTER trykket igen i redbox")
                    }
                });

                $("p.redbox").mousedown(function (e) {
                    //fjern placeholderteksten
                    if ($("p.redbox").text() === "Skriv noget her") {
                        $("p.redbox").text("")
                        console.log("Placeholder Fjernet ")
                    } else if ($("p.redbox").text() === "Skriv noget nyt...") {
                        $("p.redbox").text("")
                        console.log("Placeholder Fjernet igen")
                    }

                    //Fjern eventuelle mark-elementer i dette p-element
                    FjernMarkTag(e);
                    //
                    if (e.currentTarget.innerText != "" && kunDenEneGang && e.currentTarget.id == "") {
                        console.log(
                            "Da der ikke blev trykket ENTER i .redbox, sendes indholdet til databasen"
                        )
                        LavEnGrundnode(e)
                    }

                });
            }
            //Send grundnode afsted
            SendGrundNode()
            //Hent ID fra neo4j til den samme tekstfelt-opmærkning som netop er oprettet
            function HentIDTilGrundnode(fraGrundnoden, e) {

                e.target.setAttribute("id", fraGrundnoden.GrundNodensID)
            }


            //Marker tekst i tekstfeltet
            function SelectTextFromWindow(event) {


                var selectedText = '';

                var NodeWhichIsSelected = event.target;
                if (!window.x) {
                    console.log("Objekt til at gemme markering i laves")
                    x = {};
                }
                x.Selector = {};
                x.Selector.getSelected = function () {

                    if (window.getSelection) {
                        selectedText = window.getSelection();
                    }
                    //  else if (document.getSelection) {
                    //     selectedText = document.getSelection();
                    // } else if (document.selection) {
                    //     selectedText = document.selection.createRange().text;
                    // }
                    return selectedText;
                }
                //udfør kun hvis der ER markeret noget
                if (x.Selector.getSelected().toString() != '') {




                    //Send indholdet, hvis man har glemt at trykke ENTER
                    LavEnMarkNode(selectedText, NodeWhichIsSelected)
                };
            }
            //Opret gule mark-opmærkninger
            // OG
            //Hent ID fra neo4j til den samme mark-opmærkning som netop er oprettet
            function SurroundSelectedTextWithMarkTag(MarkNodeID) {
                var tusch = x.Selector.getSelected();
                if (document.selection && !window.getSelection) {
                    tusch.pasteHTML("<mark id=" + MarkNodeID + ">" +
                        tusch.htmlText +
                        "</mark>"); //Farv det valgte med tusch
                    console.log("markeret på: " + tusch.htmlText);
                } else {
                    var tusch = tusch.getRangeAt(0)
                    var newMarkElement = document.createElement("mark");
                    newMarkElement.setAttribute("id", MarkNodeID);
                    tusch.surroundContents(newMarkElement)
                    console.log("markering på: " + tusch.toString());

                };
            }
            //Send indhold til neo4j om at oprette en marknode
            function LavEnMarkNode(SelectedTextFromWindow, NodeTheSelectionWasMadeIn) {
                session
                    .run(
                        "CREATE (n:MARK {name:{nameParam}}) SET n.creationTime = timestamp() RETURN n.creationTime, n.name, ID(n), labels(n)", {
                            nameParam: $.trim(SelectedTextFromWindow) //Dette bliver til en Mark-node
                        })
                    .subscribe({
                        onNext: function (record) {
                            MARKNoden = {
                                MarkNodensCreationTime: record.get('n.creationTime'),
                                MarkNodensID: record.get('ID(n)'),
                                MarkNodensName: record.get('n.name'),
                                MarkNodensLabels: record.get('labels(n)')
                            }
                        },
                        onCompleted: function () {
                            SurroundSelectedTextWithMarkTag(MARKNoden.MarkNodensID)
                            LavEnMarkRel(NodeTheSelectionWasMadeIn.id, MARKNoden)
                            TjekAndreSPECEllerGRUNDNoderForMARK(MARKNoden, NodeTheSelectionWasMadeIn)
                        },
                        onError: function (error) {
                            console.log(error)
                        }
                    })
            }
            //Fjerner mark-tag fra uddybning, så man kan lave en overlappende markering
            //(det er en hack. Jeg vil foretrække at man kan markere flere gange oveni hinanden)
            function FjernMarkTag(DenNodeMarkSkalFjernesFra) {
                console.log("Der tjekkes om noden i forvejen har mark-tag")
                console.log(DenNodeMarkSkalFjernesFra.currentTarget.childElementCount)
                if (DenNodeMarkSkalFjernesFra.currentTarget.childElementCount > 0) {
                    let marktag = document.getElementById(DenNodeMarkSkalFjernesFra.target.id)
                        .getElementsByTagName(
                            'mark');
                    while (marktag.length) {
                        let parent = marktag[0].parentNode;
                        while (marktag[0].firstChild) {
                            parent.insertBefore(marktag[0].firstChild, marktag[0]);
                        }
                        parent.removeChild(marktag[0]);
                        console.log("der er fjernet mark-tag i p-tag")
                    }
                } else {
                    console.log("Der er ingen mark-tag i denne node")
                }
            }
            //Send ved mouseup
            $('body').on("mouseup", "p.redbox", function (e) {
                SelectTextFromWindow(e)
                console.log("der er mouseup i .redbox")
            })


            $('body').on("mouseup", ".greenbox", function (e) {
                SelectTextFromWindow(e)
                console.log("der er mouseup i .greenbox")
            })

            //Send indhold til neo4j om at oprrette en (MARK)relation fra den forrige (grund)node til den indeværende (Mark)node
            function LavEnMarkRel(FraNodensID, TilMarkNode) {
                session
                    .run(
                        `MATCH (n) WHERE (n:SPEC OR n:ROD) AND ID(n) = ${FraNodensID}
                                MATCH (l: ${TilMarkNode.MarkNodensLabels[0]} {creationTime:${TilMarkNode
                            .MarkNodensCreationTime}, name:"${TilMarkNode.MarkNodensName}"})
                                CREATE (n)-[r:MARK]->(l)`
                    )
                    .subscribe({
                        onNext: function () {},
                        onCompleted: function () {
                            LavEnUddybningsboks(FraNodensID, TilMarkNode)
                            //session.close()
                        },
                        onError: function (error) {
                            console.log(error)
                        }
                    })
                console.log("LavEnMarkRel: " + " ID: " +
                    FraNodensID + " Til " + TilMarkNode.MarkNodensLabels[0] + " ID: " + TilMarkNode
                    .MarkNodensID);
            };

            function TjekAndreSPECEllerGRUNDNoderForMARK(CurrentMARKNode, FraNoden) {
                //Gem de rodnoder og specnoder der indeholder denne markering
                var NoderMedSammeIndhold = []

                session
                    .run(
                        //Find uddybninger eller rodnoder der indeholder markeringen, undtagen markeringer der peger direkte på disse rødder eller uddybninger
                        `MATCH (m:MARK) WHERE ID(m) = ${CurrentMARKNode.MarkNodensID} MATCH (n) WHERE (n:SPEC OR n:ROD) AND (LOWER(n.name) CONTAINS LOWER("${CurrentMARKNode.MarkNodensName}")) AND NOT (n)-[:MARK]->(m) RETURN  n.name, n.creationTime, ID(n), labels(n)`
                    )
                    .subscribe({
                        onNext: function (record) {
                            MATCHENDENode = {
                                MATCHENDENodensCreationTime: record.get('n.creationTime'),
                                MATCHENDENodensID: record.get('ID(n)'),
                                MATCHENDENodensName: record.get('n.name'),
                                MATCHENDENodensLabels: record.get('labels(n)')
                            }
                            NoderMedSammeIndhold.push(MATCHENDENode)
                        },
                        onCompleted: function () {
                            console.log("Noder som indeholder denne markering:")
                            console.log(NoderMedSammeIndhold)
                            //Lav en association hvis der er flere end én fundne
                            if (NoderMedSammeIndhold.length >= 1) {

                                LavEnAssNode(CurrentMARKNode, NoderMedSammeIndhold, FraNoden)
                            }
                            //session.close()
                        },
                        onError: function (error) {
                            console.log(error)
                        }
                    });


            }



            //Byg en associations-relation fra Associationsnoden til alle de markeringer med samme indhold
            function LavEnAssRel(ASSNoden, NoderMedSammeIndhold) {
                for (let Markeringer = 0; Markeringer < NoderMedSammeIndhold.length; Markeringer++) {
                    const MarkeringAtLaveRelationTil = NoderMedSammeIndhold[Markeringer];
                    //Navnet på den specnode eller grundnode som der er matchet
                    console.log(MarkeringAtLaveRelationTil.MATCHENDENodensName)
                    console.log(MarkeringAtLaveRelationTil.MATCHENDENodensID)
                    session
                        .run(
                            //${MarkeringAtLaveRelationTil.MATCHENDENodensName}
                            `MATCH (n:${ASSNoden.ASSNodensLabels[0]} {creationTime:${ASSNoden.ASSNodensCreationTime}, name:"${ASSNoden.ASSNodensName}"}) MATCH (l:${MarkeringAtLaveRelationTil.MATCHENDENodensLabels[0]} {creationTime:${MarkeringAtLaveRelationTil.MATCHENDENodensCreationTime}, name:"${MarkeringAtLaveRelationTil.MATCHENDENodensName}"}) MERGE (n)-[:ASS]->(l)`
                        )
                        .subscribe({
                            onNext: function (record) {

                            },
                            onCompleted: function () {
                                console.log(
                                    "Nu er der lavet ASS-rel fra denne association til de tidligere ROD og SPEC-noder"
                                )
                            },
                            onError: function (error) {
                                console.log(error)
                            }
                        })
                };
            }


            //Lav en Associationsnode            
            function LavEnAssNode(CurrentMARKNode, NoderMedSammeIndhold, FraNoden) {
                session
                    .run(
                        "MERGE (n:ASS {name:{nameParam}}) SET n.creationTime = timestamp() RETURN n.creationTime, n.name, ID(n), labels(n)", {
                            nameParam: CurrentMARKNode.MarkNodensName
                        })
                    .subscribe({
                        onNext: function (record) {
                            ASSNoden = {
                                ASSNodensCreationTime: record.get('n.creationTime'),
                                ASSNodensID: record.get('ID(n)'),
                                ASSNodensName: record.get('n.name'),
                                ASSNodensLabels: record.get('labels(n)')
                            }
                        },
                        onCompleted: function () {
                            console.log("der er lavet en association")
                            //Lav ASS-rel til relevante noder
                            LavEnAssRel(ASSNoden, NoderMedSammeIndhold)
                            LavEnOutputboks(FraNoden, NoderMedSammeIndhold, ASSNoden)
                        },
                        onError: function (error) {
                            console.log(error)
                        }
                    })
            };
            //Opret et tekstfelt til til output af associationer (som er en ASSNODE)
            function LavEnOutputboks(FraNoden, NoderMedSammeIndhold, ASSNoden) {
                //Outputboks ÅBNES
                var NytPTag = document.createElement("p");
                $(NytPTag).attr("id", ASSNoden.ASSNodensID)
                $(NytPTag).attr("class", "purpleparagraf")
                $(NytPTag).attr("contenteditable", "true");
                //Det er her magien skal ske. Mange algoritmer skal afgøre hvad der skal stå her i dette outputfelt
                NytPTag.innerText = NoderMedSammeIndhold[0].MATCHENDENodensName;
                console.log("nu bliver der lavet en associationsboks")

                var ParentNode = document.getElementById(FraNoden.id);

                if (ParentNode.parentElement == $("p.redbox")) {
                    var nyOutputBoks = document.createElement("div")
                    $(nyOutputBoks).attr("class", "purpleboks")
                    console.log("output udspringer fra grundnode")
                    nyOutputBoks.append(NytPTag)
                } else {
                    $(NytPTag).insertAfter(ParentNode);
                }

            }

            //Opret et tekstfelt til uddybning (som er en specnode)
            function LavEnUddybningsboks(FraNodensID, MarknodenDenKommerFra) {
                //UDDYBNINGSBOKS ÅBNES
                //Først, lav et p-element
                var NytPTag = document.createElement("p");
                //Dernæst, giv attributter til det
                $(NytPTag).attr("contenteditable", "true");
                $(NytPTag).addClass("greenbox")
                console.log("Uddybningsboks udspringer fra " + MarknodenDenKommerFra.MarkNodensName)
                //Dernæst, find det element som det nye p-element skal ligge efter
                var ParentNode = document.getElementById(FraNodensID);
                //Denne funktion laver en svg og lægger den foran det nye p-element
                LavEnTaleboblePil(ParentNode, NytPTag, FraNodensID, MarknodenDenKommerFra)
                SendSpecNode(MarknodenDenKommerFra);
            }

            //Opret en taleboblehale der går fra uddybningstekstfeltet til den mark-opmærkningen som udløste (uddybnings)tekstfeltet
            //
            function LavEnTaleboblePil(ParentNode, NytPTag, FraNodensID, MarknodenDenKommerFra) {
                //Lav en omgivende ramme
                var svgramme = document.createElement('div');
                //Definér det der skal indsættes
                var svghtml = "<svg><polyline id='pilTilMark" + MarknodenDenKommerFra.MarkNodensID +
                    "' class='pil' points=''/></svg>"
                //indsæt element i omgivende ramme
                svgramme.innerHTML = svghtml;
                //indsæt p-elementet fra LavEnUddybningsboks til denne svg
                svgramme.appendChild(NytPTag);

                //Hvis markering foregår i redbox
                if (ParentNode.parentElement == $("p.redbox")) {
                    console.log("Uddybningsboks udspringer fra grundnode")
                    document.getElementsByClassName("greenbox").append(svgramme)
                } else {
                    $(svgramme).insertAfter(ParentNode);
                }

                //Find markeringens x og y-koordinater
                var markering = document.getElementById(MarknodenDenKommerFra.MarkNodensID)
                    .getBoundingClientRect()
                //Find uddybningsfeltets x og y-koordinator
                var uddybning = NytPTag.getBoundingClientRect()
                var pil = document.getElementById("pilTilMark" + MarknodenDenKommerFra.MarkNodensID);
                var placeringAfPileBen1 = parseInt(uddybning.width / 4) + "," + parseInt(
                    21) //Først sæt: x,y for tekstboks overkant
                var placeringAfPileSpids = parseInt(markering.x + (markering.width / 2)) + "," + parseInt(-
                    20) //Andet sæt: x,y for mark-tag
                var placeringAfPileBen2 = parseInt(uddybning.width / 3) + "," + parseInt(
                    21) //Tredje sæt: x,y for tekstboks overkant
                //Placering af taleboblepilens to ben og spids
                pil.setAttributeNS(null, "points", placeringAfPileBen1 + " " + placeringAfPileSpids + " " +
                    placeringAfPileBen2);
                console.log("Taleboblens pil har følgende koordinater:")
                console.log(pil.getAttributeNS(null, "points"))

            }
            //
            //(GENBRUG) Skriv i tekstfeltet og send ved Enter
            function SendSpecNode(MarknodenDenKommerFra) {
                //Hvis man bruger musen i et grønt felt som IKKE er tomt, så skal den sende til databasen


                var kunDenEneGang = true;

                $(".greenbox").keypress(function (e) {


                    if (e.which == 13 && kunDenEneGang && e.currentTarget.id == "") {
                        console.log("ENTER i .greenbox")
                        kunDenEneGang = false;
                        e.preventDefault()
                        LavEnSpecnode(MarknodenDenKommerFra, e.currentTarget)
                        e.currentTarget.removeAttribute("contenteditable")

                    }

                });

                $("body").on("mousedown", ".greenbox", function (e) {
                    FjernMarkTag(e);
                    if (e.currentTarget.innerText != "" && kunDenEneGang && e.currentTarget.id == "") {
                        console.log(
                            "Da der ikke blev trykket ENTER i .greenbox, sendes indholdet til databasen"
                        )
                        LavEnSpecnode(MarknodenDenKommerFra, e.currentTarget)
                        e.currentTarget.removeAttribute("contenteditable")
                        kunDenEneGang = false;
                    }

                });




            }
            //Send indhold til neo4j om at oprette en Spec-node
            function LavEnSpecnode(FraMarkNoden, CurrentGreenBoxWithKeypress) {
                session
                    .run(
                        "CREATE (n:SPEC {name:{nameParam}}) SET n.creationTime = timestamp() RETURN n.creationTime, n.name, ID(n), labels(n)", {
                            nameParam: CurrentGreenBoxWithKeypress.innerText
                        })
                    .subscribe({
                        onNext: function (record) {
                            SPECNoden = {
                                SpecNodensCreationTime: record.get('n.creationTime'),
                                SpecNodensID: record.get('ID(n)'),
                                SpecNodensName: record.get('n.name'),
                                SpecNodensLabels: record.get('labels(n)')
                            }

                            console.log("LavEnSpecNode: " + SPECNoden.SpecNodensLabels[0] +
                                " ,indhold: " +
                                SPECNoden.SpecNodensName + " ,ID: " + SPECNoden.SpecNodensID)
                        },
                        onCompleted: function () {
                            //Lav en spec-relation til den uddybende node til markeringen
                            HentIDTilSpecnode(SPECNoden, CurrentGreenBoxWithKeypress)
                            LavEnSpecRel(FraMarkNoden.MarkNodensID, SPECNoden)
                            //session.close()
                        },
                        onError: function (error) {
                            console.log(error)
                        }
                    })
            }
            //(GENBRUG) Hent ID fra neo4j til den samme tekstfelt-opmærkning som netop er oprettet
            function HentIDTilSpecnode(fraSpecnoden, CurrentGreenBoxWithKeypress) {
                $(CurrentGreenBoxWithKeypress).attr("id", fraSpecnoden.SpecNodensID)
            }
            //(GENBRUG) Send indhold til neo4j om at oprrette en (SPEC)relation fra den forrige (mark)node til den indeværende (spec)node
            function LavEnSpecRel(FraMarkNodensID, TilSpecNode) {
                session
                    .run(
                        `MATCH (n) WHERE (n:MARK) AND ID(n)=${FraMarkNodensID} MATCH (l:${TilSpecNode.SpecNodensLabels[0]} {creationTime:${TilSpecNode
                            .SpecNodensCreationTime},name:"${TilSpecNode.SpecNodensName}"}) CREATE (n)-[r:SPEC]->(l)`
                    )
                    .subscribe({
                        onNext: function () {},
                        onCompleted: function () {},
                        onError: function (error) {
                            console.log(error)
                        }
                    })
                console.log("LavEnSpecRel: " + " ID: " + FraMarkNodensID + " Til ID: " + TilSpecNode
                    .SpecNodensID);
            }
            //Ændr et (spec)tekstfelt til et (grundnode)tekstfelt, hvis alt indholdet i et tekstfelt (være spec- eller grund-) slettes ved Delete eller backspace (ikke ved at markere det hele, for det opretter en mark-opmærkning)
            //
            //IKKE LAVET ENDNU
            //
            //(GENBRUG) Send indhold til neo4j om at oprette en grundnode
            //
            //IKKE LAVET ENDNU
            //





        });
    </script>
</body>

</html>