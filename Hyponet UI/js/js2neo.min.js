// js2neo 2 © 2018 Nigel Small
// Licensed under the Apache License, Version 2.0
!function(n){var e="days",t="id",o="nanoseconds",i="properties",r="seconds",y=String.fromCharCode,D=DataView,l=Math.min,f=n.js2neo={version:"2",Node:function(n){s.call(this,n,t,"labels",i)},Relationship:function(n){s.call(this,n,t,"start","end","type",i)},Path:function(n){var e,t,o,i,r=n[0],s=n[1],a=n[2],u=r[0],c=[u],h=f.Relationship;for(t=0;t<a.length;t+=2)o=a[t],e=r[a[2*t+1]],0<o?(i=s[o-1],c.push(new h([i.id,u.id,e.id,i.type,i.properties]))):(i=s[s.length+o],c.push(new h([i.id,e.id,u.id,i.type,i.properties]))),c.push(e),u=e;this.entities=c},Point:function(n){s.call(this,n,"srid","x","y")},Date:function(n){s.call(this,n,e)},Time:function(n){this.seconds=n[0]/1e9,this.tz=n[1]},LocalTime:function(n){this.seconds=n[0]/1e9},DateTime:function(n){s.call(this,n,r,o,"tz")},LocalDateTime:function(n){s.call(this,n,r,o)},Duration:function(n){s.call(this,n,"months",e,r,o)},open:function(n){return new a(n)}};function p(n){return new ArrayBuffer(n||0)}function m(n){return new Uint8Array(n)}function w(){for(var n=arguments,e=n.length,t=0,o=0;o<e;o++)t+=n[o].byteLength;var i=p(t),r=m(i),s=0;for(o=0;o<e;o++)r.set(m(n[o]),s),s+=n[o].byteLength;return i}function s(n){for(var e=0;e<n.length;e++)this[arguments[e+1]]=n[e]}var b={68:f.Date,69:f.Duration,70:f.DateTime,78:f.Node,80:f.Path,82:f.Relationship,84:f.Time,88:f.Point,100:f.LocalDateTime,102:f.DateTime,114:function(n){s.call(this,n,t,"type",i)},116:f.LocalTime};function a(n){var t={secure:(n=n||{}).secure||"https:"===document.location.protocol,user:n.user,host:n.host||"localhost",port:n.port||7687,userAgent:n.userAgent||"js2neo/"+f.version},e={scheme:"basic",principal:t.user,credentials:n.password},s={inData:p(),inMessageData:p(),ready:!1,socket:new WebSocket((t.secure?"wss":"ws")+"://"+t.host+":"+t.port)},g=s.socket,o=n.onHandshake,i=n.onInit,r=n.onOpen,d=[[1,[t.userAgent,e],{112:function(){i&&i(t),s.ready=!0},127:n.onInitFailure}]],v=[];function a(n){g.send(n)}function u(){for(;0<d.length;){var n=d.shift(),u=[176+n[1].length,n[0]],e=0;function c(n){var e=m(8);new D(e.buffer).setFloat64(0,n,!1),u.push(193),e.forEach(function(n){u.push(n)})}function h(n,e,t,o){return(n=l(n,2147483647))<16?u.push(e+n):n<65536?u.push(t,n>>8,255&n):u.push(o,n>>24,n>>16&255,n>>8&255,255&n),n}function f(n){var e,t,o;if(Array.isArray(n))for(e=h(n.length,144,213,214),t=0;t<e;t++)f(n[t]);else{var i=typeof n;if("boolean"===i)u.push(n?179:178);else if("number"===i)n%1==0?-16<=(o=n)&&o<128?u.push((256+o)%256):-32768<=o&&o<32768?u.push(201,o>>8,255&o):-2147483648<=o&&o<2147483648?u.push(202,o>>24,o>>16&255,o>>8&255,255&o):c(o):c(n);else if("string"===i){var r,s=[];for(t=0;t<n.length;t++){var a=n.charCodeAt(t);(r=55296<=a&&a<56320&&t+1<n.length?65536+(a-55296<<10)+(n.charCodeAt(++t)-56320):a)<128?s.push(r):r<2048?s.push(r>>6|192,63&r|128):r<65536?s.push(r>>12|224,r>>6&63|128,63&r|128):r<1114112?s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128):s.push(255,253)}for(e=h(s.length,128,209,210),t=0;t<e;t++)u.push(s[t])}else"object"===i?function(n){for(var e,t=Object.getOwnPropertyNames(n),o=h(t.length,160,217,218),i=0;i<o;i++)f(e=t[i]),f(n[e])}(n):u.push(192)}}for(n[1].forEach(f),v.push(n[2]);u=u.slice(e),a(m([(e=l(u.length,32767))>>8,255&e].concat(u.slice(0,e)))),u.length;);}}function c(n){var o=new D(n),r=0;function s(){return o.getUint8(r++)}function i(){return r+=2,o.getUint16(r-2,!1)}function a(){return r+=4,o.getUint32(r-4,!1)}function u(n){for(var e,t,o="",i=r+n;r<i;)(e=s())<128?o+=y(e):e<192?o+="�":e<224?o+=i<r+1?"�":y((31&e)<<6|63&s()):e<240?o+=i<r+2?"�":y((15&e)<<12|(63&s())<<6|63&s()):i<r+3?o+="�":(t=((7&e)<<18|(63&s())<<12|(63&s())<<6|63&s())-65536,o+=y(55296+(t>>10),t%1024+56320));return o}function c(n){for(var e=[];n--;)e.push(t());return e}function h(n){for(var e={};n--;){e[t()]=t()}return e}function f(n){for(var e=[s()];n--;)e.push(t());return e}function t(){var n,e,t=s();return t<128?t:t<144?u(t-128):t<160?c(t-144):t<176?h(t-160):t<192?(n=f(t-176),(e=b[n[0]])?new e(n.slice(1)):n):t<193?null:t<194?(r+=8,o.getFloat64(r-8,!1)):t<196?!!(1&t):t<200?void 0:t<201?o.getInt8(r++):t<202?(r+=2,o.getInt16(r-2,!1)):t<203?(r+=4,o.getInt32(r-4,!1)):t<204?function(){for(var n=a().toString(16),e=a().toString(16);n.length<8;)n="0"+n;for(;e.length<8;)e="0"+e;return parseInt("0x"+n+e,16)}():t<208?void 0:t<209?u(s()):t<210?u(i()):t<211?u(a()):t<212?void 0:t<213?c(s()):t<214?c(i()):t<215?c(a()):t<216?void 0:t<217?h(s()):t<218?h(i()):t<219?h(a()):t<240?void 0:t-256}var e=f(s()-176),l=e[0],p=(113===l?v[0]:v.shift())[l];127===l&&d.push([14,[],{127:function(n){g.close(4002,n.code+": "+n.message)}}]),p&&p(e[1])}function h(n){for(var e,t,o,i=s.inData=w(s.inData,n.data),r=2<=i.byteLength?1:0;r;)t=2+(e=(o=m(i))[0]<<8|o[1]),i.byteLength>=t?(e?s.inMessageData=w(s.inMessageData,i.slice(2,t)):(c(s.inMessageData),s.inMessageData=p()),i=s.inData=s.inData.slice(t)):r=0}g.binaryType="arraybuffer",g.onmessage=function(n){var e=new D(n.data);t.protocolVersion=e.getInt32(0,!1),o&&o(t),g.onmessage=h,u()},g.onclose=n.onClose,g.onopen=function(){r&&r(t),a(m([96,96,176,23,0,0,0,2,0,0,0,1,0,0,0,0,0,0,0,0]))},this.run=function(n,e,t){t=t||{},n&&(d.push([16,[n,e||{}],{112:t.onHeader,127:t.onFailure}]),d.push([63,[],{112:t.onFooter,113:t.onRecord,127:t.onFailure}])),s.ready&&u()},this.close=function(){g.close(1e3)}}console.log("js2neo "+f.version)}("object"==typeof window?window:global);
